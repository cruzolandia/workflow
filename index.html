<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Priorizador de Fluxo de Trabalho</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f9f9f9; }
    h1 { color: #333; }
    .container { max-width: 800px; margin: auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    input, button, textarea { margin: 10px 0; padding: 8px; width: 100%; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
    th { background: #f0f0f0; }
    .high { background: #ffcccc; }
    .medium { background: #fff3cd; }
    .low { background: #d4edda; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ðŸ“Š Priorizar Tarefas</h1>
    <p>Cole dados do Google Sheets ou faÃ§a upload de um arquivo CSV.</p>

    <label for="csvInput">Upload CSV:</label>
    <input type="file" id="csvInput" accept=".csv" />

    <label for="pasteData">Ou cole os dados aqui (colunas: Tarefa, Prazo, Complexidade):</label>
    <textarea id="pasteData" rows="6" placeholder="Exemplo:
Tarefa A,2025-09-20,Alta
Tarefa B,2025-09-25,MÃ©dia
Tarefa C,2025-10-01,Baixa"></textarea>

    <button onclick="processData()">Processar</button>

    <table id="resultTable">
      <thead>
        <tr>
          <th>Tarefa</th>
          <th>Prazo</th>
          <th>Complexidade</th>
          <th>Prioridade</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    function parseCSV(text) {
      return text.trim().split("\n").map(line => line.split(","));
    }

    function calcularPrioridade(prazo, complexidade) {
      const hoje = new Date();
      const prazoDate = new Date(prazo);
      const diasRestantes = Math.ceil((prazoDate - hoje) / (1000*60*60*24));

      let score = 0;
      if (diasRestantes <= 3) score += 2;
      else if (diasRestantes <= 7) score += 1;

      if (complexidade.toLowerCase().includes("alta")) score += 2;
      else if (complexidade.toLowerCase().includes("mÃ©dia")) score += 1;

      if (score >= 3) return "Alta";
      if (score == 2) return "MÃ©dia";
      return "Baixa";
    }

    function processData() {
      const tableBody = document.querySelector("#resultTable tbody");
      tableBody.innerHTML = "";

      let rows = [];

      // Se colou no textarea
      const pasted = document.getElementById("pasteData").value;
      if (pasted.trim()) {
        rows = parseCSV(pasted);
      }

      // Se fez upload CSV
      const fileInput = document.getElementById("csvInput");
      if (fileInput.files.length > 0) {
        const reader = new FileReader();
        reader.onload = function(e) {
          rows = parseCSV(e.target.result);
          renderRows(rows);
        }
        reader.readAsText(fileInput.files[0]);
        return;
      }

      renderRows(rows);
    }

    function renderRows(rows) {
      const tableBody = document.querySelector("#resultTable tbody");
      tableBody.innerHTML = "";

      rows.forEach(r => {
        if (r.length < 3) return;
        const [tarefa, prazo, complexidade] = r;
        const prioridade = calcularPrioridade(prazo, complexidade);

        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${tarefa}</td>
          <td>${prazo}</td>
          <td>${complexidade}</td>
          <td class="${prioridade.toLowerCase()}">${prioridade}</td>
        `;
        tableBody.appendChild(tr);
      });
    }
  </script>
</body>
</html>
